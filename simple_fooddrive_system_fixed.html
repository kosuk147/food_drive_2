<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éï„Éº„Éâ„Éâ„É©„Ç§„ÉñÈÄ£Êê∫„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', 'Yu Gothic', 'Hiragino Sans', sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .login-title {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: #6c757d;
            margin-bottom: 30px;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .login-btn:hover {
            background: #34495e;
        }
        
        .login-error {
            color: #e74c3c;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .tab-container {
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: #6c757d;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s ease;
            border: none;
            font-size: 16px;
        }
        
        .tab.active {
            background: #2c3e50;
        }
        
        .tab:hover {
            background: #495057;
        }
        
        .tab.active:hover {
            background: #2c3e50;
        }
        
        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #2c3e50;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: #2c3e50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #34495e;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-processed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #2c3e50;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            max-width: 300px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .container {
                padding: 10px;
            }
            
            .tab-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- „Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="login-title">üîê</div>
            <h2>„Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞„Ç§„É≥</h2>
            <p class="login-subtitle">„Éï„Éº„Éâ„Éâ„É©„Ç§„ÉñÈÄ£Êê∫„Ç∑„Çπ„ÉÜ„É†„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„Å´„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂøÖË¶Å„Åß„Åô</p>
            <form id="systemLoginForm">
                <input type="password" id="systemPassword" class="login-input" placeholder="„Ç∑„Çπ„ÉÜ„É†„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ" required>
                <button type="submit" class="login-btn">„É≠„Ç∞„Ç§„É≥</button>
            </form>
            <div id="loginError" class="login-error" style="display: none;"></div>
        </div>
    </div>
    
    <!-- „É°„Ç§„É≥„Ç∑„Çπ„ÉÜ„É† -->
    <div id="mainSystem" class="hidden">
        <div class="container">
            <div class="header">
                <h1>üç± „Éï„Éº„Éâ„Éâ„É©„Ç§„ÉñÈÄ£Êê∫„Ç∑„Çπ„ÉÜ„É†</h1>
                <p>„Çª„Ç´„É≥„Éâ„Éè„Éº„Éô„Çπ„Éà„Ç∏„É£„Éë„É≥ √ó „Éï„Ç°„É≥„ÇØ„É©„Éñ</p>
            </div>
            
            <div class="tab-container">
                <div class="tabs">
                    <button class="tab active" onclick="showTab('harvest', this)">„Çª„Ç´„É≥„Éâ„Éè„Éº„Éô„Çπ„ÉàÂÖ•Âäõ</button>
                    <button class="tab" onclick="showTab('fanclub', this)">„Éï„Ç°„É≥„ÇØ„É©„ÉñÁÆ°ÁêÜ üîí</button>
                    <button class="tab" onclick="showTab('dashboard', this)">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ üîí</button>
                </div>
                
                <div class="tab-content">
                    <!-- „Çª„Ç´„É≥„Éâ„Éè„Éº„Éô„Çπ„ÉàÂÖ•ÂäõÁîªÈù¢ -->
                    <div id="harvest" class="tab-pane active">
                        <h2>üì¶ È£üÂìÅÂèóÂèñ„Éá„Éº„ÇøÂÖ•Âäõ</h2>
                        <p>„Éï„Ç°„É≥„ÇØ„É©„Éñ‰ºöÂì°„Åã„ÇâÂèó„ÅëÂèñ„Å£„ÅüÈ£üÂìÅ„ÅÆÊÉÖÂ†±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                        
                        <form id="participantForm">
                            <div class="form-group">
                                <label for="memberId">‰ºöÂì°Áï™Âè∑ *</label>
                                <input type="text" id="memberId" name="memberId" required placeholder="‰æã: FC12345">
                            </div>
                            
                            <div class="form-group">
                                <label for="memberName">„ÅäÂêçÂâçÔºàËãóÂ≠ó„ÅÆ„ÅøÔºâ *</label>
                                <input type="text" id="memberName" name="memberName" required placeholder="‰æã: Áî∞‰∏≠">
                            </div>
                            
                            <div class="form-group">
                                <label for="receivedDate">ÂèóÂèñÊó• *</label>
                                <input type="date" id="receivedDate" name="receivedDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="notes">ÂÇôËÄÉ</label>
                                <textarea id="notes" name="notes" rows="3" placeholder="ÁâπË®ò‰∫ãÈ†Ö„Åå„ÅÇ„Çå„Å∞ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">üìù „Éá„Éº„Çø„ÇíÁôªÈå≤</button>
                            <button type="button" class="btn btn-warning" onclick="clearForm()">üîÑ „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢</button>
                        </form>
                        
                        <div id="harvestAlert" style="display: none;"></div>
                        
                        <h3>üìã ÊúÄËøë„ÅÆÁôªÈå≤„Éá„Éº„Çø <span style="font-size: 0.8em; color: #6c757d;">üîí „Éë„Çπ„ÉØ„Éº„Éâ‰øùË≠∑</span></h3>
                        <table class="data-table" id="recentData">
                            <thead>
                                <tr>
                                    <th>‰ºöÂì°Áï™Âè∑</th>
                                    <th>„ÅäÂêçÂâç</th>
                                    <th>ÂèóÂèñÊó•</th>
                                    <th>„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="recentDataBody">
                                <!-- JavaScript „ÅßÂãïÁöÑ„Å´ËøΩÂä† -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- „Éï„Ç°„É≥„ÇØ„É©„ÉñÁÆ°ÁêÜÁîªÈù¢ -->
                    <div id="fanclub" class="tab-pane">
                        <h2>üéØ „Éï„Ç°„É≥„ÇØ„É©„ÉñÁÆ°ÁêÜ <span style="font-size: 0.8em; color: #6c757d;">üîí ÁÆ°ÁêÜËÄÖÂ∞ÇÁî®</span></h2>
                        
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="‰ºöÂì°Áï™Âè∑„ÉªÂêçÂâç„ÅßÊ§úÁ¥¢..." onkeyup="searchParticipants()">
                            <button class="btn btn-primary" onclick="searchParticipants()">üîç Ê§úÁ¥¢</button>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-success" onclick="processRewards()">üéÅ ÁâπÂÖ∏ÈÖçÂ∏ÉÂÆüË°å</button>
                            <button class="btn btn-warning" onclick="exportData()">üìä „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                            <button class="btn btn-primary" onclick="sendStamps()">üèÜ „Çπ„Çø„É≥„Éó‰ªò‰∏é</button>
                        </div>
                        
                        <div id="fanclubAlert" style="display: none;"></div>
                        
                        <h3>üë• ÂèÇÂä†ËÄÖÁÆ°ÁêÜ</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" onchange="toggleAll(this)"></th>
                                    <th>‰ºöÂì°Áï™Âè∑</th>
                                    <th>„ÅäÂêçÂâç</th>
                                    <th>ÂèóÂèñÊó•</th>
                                    <th>Âá¶ÁêÜÊó•</th>
                                    <th>„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                    <th>„Çπ„Çø„É≥„ÉóÊï∞</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="participantsTableBody">
                                <!-- JavaScript „ÅßÂãïÁöÑ„Å´ËøΩÂä† -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px;">
                            <h3>üéÅ ÁâπÂÖ∏ÈÖçÂ∏ÉË®≠ÂÆö</h3>
                            <div class="form-group">
                                <label for="rewardContent">ÁâπÂÖ∏ÂÜÖÂÆπ</label>
                                <textarea id="rewardContent" rows="3" placeholder="ÈÖçÂ∏É„Åô„ÇãÁâπÂÖ∏„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                            </div>
                            <button class="btn btn-success" onclick="setRewardContent()">‚úÖ ÁâπÂÖ∏ÂÜÖÂÆπ„Çí‰øùÂ≠ò</button>
                        </div>
                    </div>
                    
                    <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
                    <div id="dashboard" class="tab-pane">
                        <h2>üìä „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ <span style="font-size: 0.8em; color: #6c757d;">üîí ÁÆ°ÁêÜËÄÖÂ∞ÇÁî®</span></h2>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalParticipants">0</div>
                                <div class="stat-label">Á∑èÂèÇÂä†ËÄÖÊï∞</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="todayParticipants">0</div>
                                <div class="stat-label">‰ªäÊó•„ÅÆÂèÇÂä†ËÄÖ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="pendingProcess">0</div>
                                <div class="stat-label">Âá¶ÁêÜÂæÖ„Å°</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalStamps">0</div>
                                <div class="stat-label">‰ªò‰∏é„Çπ„Çø„É≥„ÉóÊï∞</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 30px;">
                            <h3>üìà ÂèÇÂä†Áä∂Ê≥Å„Ç∞„É©„Éï</h3>
                            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; min-height: 200px; display: flex; align-items: center; justify-content: center; color: #6c757d;">
                                üìä „Ç∞„É©„ÉïË°®Á§∫„Ç®„É™„Ç¢<br>
                                <small>ÔºàÂÆüË£ÖÊôÇ„Å´Chart.js„Å™„Å©„Çí‰ΩøÁî®Ôºâ</small>
                            </div>
                        </div>
                        
                        <div>
                            <h3>üîÑ „Ç∑„Çπ„ÉÜ„É†Êìç‰Ωú</h3>
                            <button class="btn btn-primary" onclick="refreshDashboard()">üîÑ „Éá„Éº„ÇøÊõ¥Êñ∞</button>
                            <button class="btn btn-warning" onclick="backupData()">üíæ „Éá„Éº„Çø„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó</button>
                            <button class="btn btn-danger" onclick="clearTestData()">üóëÔ∏è „ÉÜ„Çπ„Éà„Éá„Éº„Çø„ÇØ„É™„Ç¢</button>
                            <button class="btn" onclick="logout()" style="background: #e74c3c; color: white; margin-left: 20px;">üö™ „Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3>üìã „Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞</h3>
                            <div id="systemLog" style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                                <div>2025-07-23 10:00:00 - „Ç∑„Çπ„ÉÜ„É†Ëµ∑Âãï</div>
                                <div>2025-07-23 10:01:00 - „Éá„Éº„ÇøÂàùÊúüÂåñÂÆå‰∫Ü</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // „Éá„Éº„Çø‰øùÂ≠òÁî®ÔºàÂÆüÈöõ„ÅÆÈÅãÁî®„Åß„ÅØÂ§ñÈÉ®„Éá„Éº„Çø„Éô„Éº„Çπ„Çí‰ΩøÁî®Ôºâ
        let participants = JSON.parse(localStorage.getItem('participants') || '[]');
        let rewardContent = localStorage.getItem('rewardContent') || 'ÈôêÂÆöÂ£ÅÁ¥ô„Å®„É°„ÉÉ„Çª„Éº„Ç∏ÂãïÁîª„Çí„ÅäÈÄÅ„Çä„Åó„Åæ„Åô„ÄÇ„ÅîÂèÇÂä†„ÅÑ„Åü„Å†„Åç„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„ÅüÔºÅ';
        
        // „Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö
        const SYSTEM_PASSWORD = 'systemfam08';
        const DATA_VIEW_PASSWORD = 'scdfambam';
        const ADMIN_PASSWORD = 'fambam0819';
        
        // Ë™çË®ºÁä∂ÊÖãÁÆ°ÁêÜ
        let isSystemAuthenticated = false;
        let isDataViewAuthenticated = false;
        let isAdminAuthenticated = false;
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // „Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞„Ç§„É≥„Éï„Ç©„Éº„É†„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            document.getElementById('systemLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const password = document.getElementById('systemPassword').value;
                
                if (password === SYSTEM_PASSWORD) {
                    isSystemAuthenticated = true;
                    document.getElementById('loginOverlay').classList.add('hidden');
                    document.getElementById('mainSystem').classList.remove('hidden');
                    initializeSystem();
                    addSystemLog('„Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞„Ç§„É≥ÊàêÂäü');
                } else {
                    document.getElementById('loginError').textContent = '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
                    document.getElementById('loginError').style.display = 'block';
                    document.getElementById('systemPassword').value = '';
                }
            });
        });
        
        // „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
        function initializeSystem() {
            document.getElementById('receivedDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('rewardContent').value = rewardContent;
            
            // ÂèÇÂä†ËÄÖ„Éá„Éº„ÇøÁôªÈå≤„Éï„Ç©„Éº„É†„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
            document.getElementById('participantForm').addEventListener('submit', handleParticipantSubmit);
            
            updateRecentData();
            updateParticipantsTable();
            updateDashboard();
            addSystemLog('„Ç∑„Çπ„ÉÜ„É†Ê∫ñÂÇôÂÆå‰∫Ü');
        }
        
        // ÂèÇÂä†ËÄÖ„Éá„Éº„ÇøÁôªÈå≤Âá¶ÁêÜ„ÇíÈñ¢Êï∞„Å®„Åó„Å¶ÂàÜÈõ¢
        function handleParticipantSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const participant = {
                id: Date.now(),
                memberId: formData.get('memberId'),
                memberName: formData.get('memberName'),
                receivedDate: formData.get('receivedDate'),
                notes: formData.get('notes'),
                status: 'pending',
                processedAt: null,
                stampCount: 0,
                createdAt: new Date().toISOString()
            };
            
            // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
            const existing = participants.find(p => 
                p.memberId === participant.memberId && 
                p.receivedDate === participant.receivedDate
            );
            
            if (existing) {
                showAlert('harvestAlert', 'warning', '‚ö†Ô∏è Âêå„Åò‰ºöÂì°Áï™Âè∑„ÉªÂêå„ÅòÊó•‰ªò„ÅÆ„Éá„Éº„Çø„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô„ÄÇ');
                return;
            }
            
            participants.push(participant);
            localStorage.setItem('participants', JSON.stringify(participants));
            
            showAlert('harvestAlert', 'success', '‚úÖ „Éá„Éº„Çø„ÇíÊ≠£Â∏∏„Å´ÁôªÈå≤„Åó„Åæ„Åó„Åü„ÄÇ');
            clearForm();
            updateRecentData();
            updateParticipantsTable();
            addSystemLog(`Êñ∞Ë¶èÂèÇÂä†ËÄÖÁôªÈå≤: ${participant.memberId} (${participant.memberName})`);
        }
        
        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function showTab(tabName, tabButton) {
            // Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
            if (tabName === 'harvest' && !checkDataViewAuth()) {
                return;
            }
            if ((tabName === 'fanclub' || tabName === 'dashboard') && !checkAdminAuth()) {
                return;
            }
            
            // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Å®„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            tabButton.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅåË°®Á§∫„Åï„Çå„ÅüÊôÇ„ÅØ„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
            if (tabName === 'dashboard') {
                updateDashboard();
            }
        }
        
        // „Éá„Éº„ÇøÈñ≤Ë¶ßË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
        function checkDataViewAuth() {
            if (!isDataViewAuthenticated) {
                const password = prompt('„Éá„Éº„ÇøÈñ≤Ë¶ß„Å´„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂøÖË¶Å„Åß„ÅôÔºö');
                if (password === DATA_VIEW_PASSWORD) {
                    isDataViewAuthenticated = true;
                    updateRecentData();
                    return true;
                } else if (password !== null) {
                    alert('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                }
                return false;
            }
            return true;
        }
        
        // ÁÆ°ÁêÜËÄÖË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
        function checkAdminAuth() {
            if (!isAdminAuthenticated) {
                const password = prompt('ÁÆ°ÁêÜËÄÖ„Ç®„É™„Ç¢„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„Å´„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂøÖË¶Å„Åß„ÅôÔºö');
                if (password === ADMIN_PASSWORD) {
                    isAdminAuthenticated = true;
                    return true;
                } else if (password !== null) {
                    alert('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                }
                return false;
            }
            return true;
        }
        
        // ÂèÇÂä†ËÄÖ„Éá„Éº„ÇøÁôªÈå≤Ôºà„Åì„ÅÆÈÉ®ÂàÜ„ÇíÂâäÈô§Ôºâ
        
        // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
        function clearForm() {
            document.getElementById('participantForm').reset();
            document.getElementById('receivedDate').value = new Date().toISOString().split('T')[0];
        }
        
        // „Ç¢„É©„Éº„ÉàË°®Á§∫
        function showAlert(elementId, type, message) {
            const alertElement = document.getElementById(elementId);
            alertElement.className = `alert alert-${type}`;
            alertElement.innerHTML = message;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }
        
        // ÊúÄËøë„ÅÆ„Éá„Éº„ÇøÊõ¥Êñ∞
        function updateRecentData() {
            if (!isDataViewAuthenticated) {
                document.getElementById('recentDataBody').innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">üîí „Éá„Éº„ÇøÈñ≤Ë¶ß„Å´„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂøÖË¶Å„Åß„Åô</td></tr>';
                return;
            }
            
            const tbody = document.getElementById('recentDataBody');
            const recentParticipants = participants.slice(-10).reverse();
            
            tbody.innerHTML = recentParticipants.map(p => `
                <tr>
                    <td>${p.memberId}</td>
                    <td>${p.memberName}</td>
                    <td>${p.receivedDate}</td>
                    <td><span class="status-badge status-${p.status}">${getStatusText(p.status)}</span></td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteParticipant(${p.id})" style="padding: 4px 8px; font-size: 12px;">ÂâäÈô§</button>
                    </td>
                </tr>
            `).join('');
        }
        
        // ÂèÇÂä†ËÄÖ„ÉÜ„Éº„Éñ„É´Êõ¥Êñ∞
        function updateParticipantsTable() {
            const tbody = document.getElementById('participantsTableBody');
            
            tbody.innerHTML = participants.map(p => `
                <tr>
                    <td><input type="checkbox" value="${p.id}" class="participant-checkbox"></td>
                    <td>${p.memberId}</td>
                    <td>${p.memberName}</td>
                    <td>${p.receivedDate}</td>
                    <td>${p.processedAt ? new Date(p.processedAt).toLocaleDateString() : '-'}</td>
                    <td><span class="status-badge status-${p.status}">${getStatusText(p.status)}</span></td>
                    <td>${p.stampCount || 0}</td>
                    <td>
                        <button class="btn btn-success" onclick="processIndividual(${p.id})" style="padding: 4px 8px; font-size: 12px;" ${p.status === 'processed' ? 'disabled' : ''}>
                            ${p.status === 'processed' ? 'ÂÆå‰∫Ü' : 'Âá¶ÁêÜ'}
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // „Çπ„ÉÜ„Éº„Çø„Çπ„ÉÜ„Ç≠„Çπ„ÉàÂèñÂæó
        function getStatusText(status) {
            const statusMap = {
                'pending': 'Âá¶ÁêÜÂæÖ„Å°',
                'processed': 'ÂÆå‰∫Ü',
                'error': '„Ç®„É©„Éº'
            };
            return statusMap[status] || status;
        }
        
        // ÂèÇÂä†ËÄÖÂâäÈô§
        function deleteParticipant(id) {
            if (confirm('„Åì„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                participants = participants.filter(p => p.id !== id);
                localStorage.setItem('participants', JSON.stringify(participants));
                updateRecentData();
                updateParticipantsTable();
                updateDashboard();
                addSystemLog(`ÂèÇÂä†ËÄÖ„Éá„Éº„ÇøÂâäÈô§: ID ${id}`);
            }
        }
        
        // ÂÄãÂà•Âá¶ÁêÜ
        function processIndividual(id) {
            const participant = participants.find(p => p.id === id);
            if (participant && participant.status === 'pending') {
                participant.status = 'processed';
                participant.processedAt = new Date().toISOString();
                participant.stampCount = (participant.stampCount || 0) + 1;
                
                localStorage.setItem('participants', JSON.stringify(participants));
                updateParticipantsTable();
                updateDashboard();
                addSystemLog(`ÁâπÂÖ∏ÈÖçÂ∏ÉÂÆå‰∫Ü: ${participant.memberId}`);
                
                showAlert('fanclubAlert', 'success', `‚úÖ ${participant.memberName}„Åï„Çì„ÅÆÁâπÂÖ∏ÈÖçÂ∏É„ÇíÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ`);
            }
        }
        
        // ÁâπÂÖ∏ÈÖçÂ∏ÉÂÆüË°å
        function processRewards() {
            const checkboxes = document.querySelectorAll('.participant-checkbox:checked');
            if (checkboxes.length === 0) {
                showAlert('fanclubAlert', 'warning', '‚ö†Ô∏è Âá¶ÁêÜ„Åô„ÇãÂèÇÂä†ËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            let processedCount = 0;
            checkboxes.forEach(checkbox => {
                const id = parseInt(checkbox.value);
                const participant = participants.find(p => p.id === id);
                if (participant && participant.status === 'pending') {
                    participant.status = 'processed';
                    participant.processedAt = new Date().toISOString();
                    participant.stampCount = (participant.stampCount || 0) + 1;
                    processedCount++;
                }
            });
            
            if (processedCount > 0) {
                localStorage.setItem('participants', JSON.stringify(participants));
                updateParticipantsTable();
                updateDashboard();
                addSystemLog(`‰∏ÄÊã¨ÁâπÂÖ∏ÈÖçÂ∏É: ${processedCount}‰ª∂`);
                showAlert('fanclubAlert', 'success', `‚úÖ ${processedCount}‰ª∂„ÅÆÁâπÂÖ∏ÈÖçÂ∏É„ÇíÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ`);
            }
        }
        
        // „Çπ„Çø„É≥„Éó‰ªò‰∏é
        function sendStamps() {
            const checkboxes = document.querySelectorAll('.participant-checkbox:checked');
            if (checkboxes.length === 0) {
                showAlert('fanclubAlert', 'warning', '‚ö†Ô∏è „Çπ„Çø„É≥„Éó„Çí‰ªò‰∏é„Åô„ÇãÂèÇÂä†ËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            checkboxes.forEach(checkbox => {
                const id = parseInt(checkbox.value);
                const participant = participants.find(p => p.id === id);
                if (participant) {
                    participant.stampCount = (participant.stampCount || 0) + 1;
                }
            });
            
            localStorage.setItem('participants', JSON.stringify(participants));
            updateParticipantsTable();
            updateDashboard();
            addSystemLog(`„Çπ„Çø„É≥„Éó‰ªò‰∏é: ${checkboxes.length}‰ª∂`);
            showAlert('fanclubAlert', 'success', `üèÜ ${checkboxes.length}‰ª∂„ÅÆ„Çπ„Çø„É≥„Éó„Çí‰ªò‰∏é„Åó„Åæ„Åó„Åü„ÄÇ`);
        }
        
        // ÂÖ®ÈÅ∏ÊäûÂàá„ÇäÊõø„Åà
        function toggleAll(master) {
            const checkboxes = document.querySelectorAll('.participant-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = master.checked;
            });
        }
        
        // Ê§úÁ¥¢
        function searchParticipants() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#participantsTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // ÁâπÂÖ∏ÂÜÖÂÆπ‰øùÂ≠ò
        function setRewardContent() {
            const content = document.getElementById('rewardContent').value;
            localStorage.setItem('rewardContent', content);
            rewardContent = content;
            showAlert('fanclubAlert', 'success', '‚úÖ ÁâπÂÖ∏ÂÜÖÂÆπ„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü„ÄÇ');
        }
        
        // „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "‰ºöÂì°Áï™Âè∑,„ÅäÂêçÂâç,ÂèóÂèñÊó•,Âá¶ÁêÜÊó•,„Çπ„ÉÜ„Éº„Çø„Çπ,„Çπ„Çø„É≥„ÉóÊï∞,ÂÇôËÄÉ\n"
                + participants.map(p => 
                    `${p.memberId},${p.memberName},${p.receivedDate},${p.processedAt || ''},${getStatusText(p.status)},${p.stampCount || 0},"${p.notes || ''}"`
                ).join('\n');
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `fooddrive_data_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addSystemLog('„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÂÆüË°å');
        }
        
        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊõ¥Êñ∞
        function updateDashboard() {
            const total = participants.length;
            const today = new Date().toISOString().split('T')[0];
            const todayCount = participants.filter(p => p.receivedDate === today).length;
            const pending = participants.filter(p => p.status === 'pending').length;
            const totalStamps = participants.reduce((sum, p) => sum + (p.stampCount || 0), 0);
            
            document.getElementById('totalParticipants').textContent = total;
            document.getElementById('todayParticipants').textContent = todayCount;
            document.getElementById('pendingProcess').textContent = pending;
            document.getElementById('totalStamps').textContent = totalStamps;
        }
        
        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊõ¥Êñ∞„Éú„Çø„É≥
        function refreshDashboard() {
            updateDashboard();
            addSystemLog('„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊâãÂãïÊõ¥Êñ∞');
            showAlert('fanclubAlert', 'success', '‚úÖ „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü„ÄÇ');
        }
        
        // „Éá„Éº„Çø„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
        function backupData() {
            const backupData = {
                participants: participants,
                rewardContent: rewardContent,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `fooddrive_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            addSystemLog('„Éá„Éº„Çø„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó‰ΩúÊàê');
        }
        
        // „ÉÜ„Çπ„Éà„Éá„Éº„Çø„ÇØ„É™„Ç¢
        function clearTestData() {
            if (confirm('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                participants = [];
                localStorage.clear();
                updateRecentData();
                updateParticipantsTable();
                updateDashboard();
                addSystemLog('ÂÖ®„Éá„Éº„Çø„ÇØ„É™„Ç¢ÂÆüË°å');
                alert('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        }
        
        // „É≠„Ç∞„Ç¢„Ç¶„ÉàÊ©üËÉΩ
        function logout() {
            if (confirm('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
                isSystemAuthenticated = false;
                isDataViewAuthenticated = false;
                isAdminAuthenticated = false;
                
                // „Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Å´Êàª„Çã
                document.getElementById('mainSystem').classList.add('hidden');
                document.getElementById('loginOverlay').classList.remove('hidden');
                document.getElementById('systemPassword').value = '';
                document.getElementById('loginError').style.display = 'none';
                
                // ÊúÄÂàù„ÅÆ„Çø„Éñ„Å´Êàª„Åô
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                document.querySelector('.tab').classList.add('active');
                document.getElementById('harvest').classList.add('active');
                
                updateRecentData();
                addSystemLog('„Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞„Ç¢„Ç¶„Éà');
            }
        }
        
        // „Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞ËøΩÂä†
        function addSystemLog(message) {
            const timestamp = new Date().toLocaleString('ja-JP');
            const logElement = document.getElementById('systemLog');
            const logEntry = document.createElement('div');
            logEntry.textContent = `${timestamp} - ${message}`;
            logElement.appendChild(logEntry);
            
            // „É≠„Ç∞„ÅåÂ§ö„Åè„Å™„Å£„Åü„ÇâÂè§„ÅÑ„ÇÇ„ÅÆ„ÇíÂâäÈô§
            if (logElement.children.length > 50) {
                logElement.removeChild(logElement.firstChild);
            }
            
            // ÊúÄÊñ∞„É≠„Ç∞„ÅåË¶ã„Åà„Çã„Çà„ÅÜ„Å´„Çπ„ÇØ„É≠„Éº„É´
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // ÂÆöÊúüÁöÑ„Å™„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊõ¥Êñ∞Ôºà30ÁßíÈñìÈöîÔºâ
        setInterval(updateDashboard, 30000);
        
        // „Éö„Éº„Ç∏Èõ¢ËÑ±ÊôÇ„ÅÆÁ¢∫Ë™ç
        window.addEventListener('beforeunload', function(e) {
            const pendingCount = participants.filter(p => p.status === 'pending').length;
            if (pendingCount > 0) {
                e.preventDefault();
                e.returnValue = 'Âá¶ÁêÜÂæÖ„Å°„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Éö„Éº„Ç∏„ÇíÈõ¢„Çå„Åæ„Åô„ÅãÔºü';
            }
        });
    </script>
</body>
</html>