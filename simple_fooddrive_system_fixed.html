<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ãƒ¼ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒ–é€£æºã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', 'Yu Gothic', 'Hiragino Sans', sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .login-title {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: #6c757d;
            margin-bottom: 30px;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .login-btn:hover {
            background: #34495e;
        }
        
        .login-error {
            color: #e74c3c;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .tab-container {
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: #6c757d;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s ease;
            border: none;
            font-size: 16px;
        }
        
        .tab.active {
            background: #2c3e50;
        }
        
        .tab:hover {
            background: #495057;
        }
        
        .tab.active:hover {
            background: #2c3e50;
        }
        
        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #2c3e50;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: #2c3e50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #34495e;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-processed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #2c3e50;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            max-width: 300px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .container {
                padding: 10px;
            }
            
            .tab-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="login-title">ğŸ”</div>
            <h2>ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚¤ãƒ³</h2>
            <p class="login-subtitle">ãƒ•ãƒ¼ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒ–é€£æºã‚·ã‚¹ãƒ†ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</p>
            <form id="systemLoginForm">
                <input type="password" id="systemPassword" class="login-input" placeholder="ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" required>
                <button type="submit" class="login-btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </form>
            <div id="loginError" class="login-error" style="display: none;"></div>
        </div>
    </div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ  -->
    <div id="mainSystem" class="hidden">
        <div class="container">
            <div class="header">
                <h1>ğŸ± ãƒ•ãƒ¼ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒ–é€£æºã‚·ã‚¹ãƒ†ãƒ </h1>
                <p>ã‚»ã‚«ãƒ³ãƒ‰ãƒãƒ¼ãƒ™ã‚¹ãƒˆã‚¸ãƒ£ãƒ‘ãƒ³ Ã— ãƒ•ã‚¡ãƒ³ã‚¯ãƒ©ãƒ–</p>
            </div>
            
            <div class="tab-container">
                <div class="tabs">
                    <button class="tab active" onclick="showTab('harvest', this)">ã‚»ã‚«ãƒ³ãƒ‰ãƒãƒ¼ãƒ™ã‚¹ãƒˆå…¥åŠ›</button>
                    <button class="tab" onclick="showTab('fanclub', this)">ãƒ•ã‚¡ãƒ³ã‚¯ãƒ©ãƒ–ç®¡ç† ğŸ”’</button>
                    <button class="tab" onclick="showTab('dashboard', this)">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ ğŸ”’</button>
                </div>
                
                <div class="tab-content">
                    <!-- ã‚»ã‚«ãƒ³ãƒ‰ãƒãƒ¼ãƒ™ã‚¹ãƒˆå…¥åŠ›ç”»é¢ -->
                    <div id="harvest" class="tab-pane active">
                        <h2>ğŸ“¦ é£Ÿå“å—å–ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
                        <p>ãƒ•ã‚¡ãƒ³ã‚¯ãƒ©ãƒ–ä¼šå“¡ã‹ã‚‰å—ã‘å–ã£ãŸé£Ÿå“ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                        
                        <form id="participantForm">
                            <div class="form-group">
                                <label for="memberId">ä¼šå“¡ç•ªå· *</label>
                                <input type="text" id="memberId" name="memberId" required placeholder="ä¾‹: FC12345">
                            </div>
                            
                            <div class="form-group">
                                <label for="memberName">ãŠåå‰ï¼ˆè‹—å­—ã®ã¿ï¼‰ *</label>
                                <input type="text" id="memberName" name="memberName" required placeholder="ä¾‹: ç”°ä¸­">
                            </div>
                            
                            <div class="form-group">
                                <label for="receivedDate">å—å–æ—¥ *</label>
                                <input type="date" id="receivedDate" name="receivedDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="notes">å‚™è€ƒ</label>
                                <textarea id="notes" name="notes" rows="3" placeholder="ç‰¹è¨˜äº‹é …ãŒã‚ã‚Œã°å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²</button>
                            <button type="button" class="btn btn-warning" onclick="clearForm()">ğŸ”„ ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢</button>
                        </form>
                        
                        <div id="harvestAlert" style="display: none;"></div>
                        
                        <h3>ğŸ“‹ æœ€è¿‘ã®ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ <span style="font-size: 0.8em; color: #6c757d;">ğŸ”’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·</span></h3>
                        <table class="data-table" id="recentData">
                            <thead>
                                <tr>
                                    <th>ä¼šå“¡ç•ªå·</th>
                                    <th>ãŠåå‰</th>
                                    <th>å—å–æ—¥</th>
                                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="recentDataBody">
                                <!-- JavaScript ã§å‹•çš„ã«è¿½åŠ  -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- ãƒ•ã‚¡ãƒ³ã‚¯ãƒ©ãƒ–ç®¡ç†ç”»é¢ -->
                    <div id="fanclub" class="tab-pane">
                        <h2>ğŸ¯ ãƒ•ã‚¡ãƒ³ã‚¯ãƒ©ãƒ–ç®¡ç† <span style="font-size: 0.8em; color: #6c757d;">ğŸ”’ ç®¡ç†è€…å°‚ç”¨</span></h2>
                        
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="ä¼šå“¡ç•ªå·ãƒ»åå‰ã§æ¤œç´¢..." onkeyup="searchParticipants()">
                            <button class="btn btn-primary" onclick="searchParticipants()">ğŸ” æ¤œç´¢</button>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-success" onclick="processRewards()">ğŸ ç‰¹å…¸é…å¸ƒå®Ÿè¡Œ</button>
                            <button class="btn btn-warning" onclick="exportData()">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                            <button class="btn btn-primary" onclick="sendStamps()">ğŸ† ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ä¸</button>
                        </div>
                        
                        <div id="fanclubAlert" style="display: none;"></div>
                        
                        <h3>ğŸ‘¥ å‚åŠ è€…ç®¡ç†</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" onchange="toggleAll(this)"></th>
                                    <th>ä¼šå“¡ç•ªå·</th>
                                    <th>ãŠåå‰</th>
                                    <th>å—å–æ—¥</th>
                                    <th>å‡¦ç†æ—¥</th>
                                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                    <th>ã‚¹ã‚¿ãƒ³ãƒ—æ•°</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="participantsTableBody">
                                <!-- JavaScript ã§å‹•çš„ã«è¿½åŠ  -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px;">
                            <h3>ğŸ ç‰¹å…¸é…å¸ƒè¨­å®š</h3>
                            <div class="form-group">
                                <label for="rewardContent">ç‰¹å…¸å†…å®¹</label>
                                <textarea id="rewardContent" rows="3" placeholder="é…å¸ƒã™ã‚‹ç‰¹å…¸ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                            </div>
                            <button class="btn btn-success" onclick="setRewardContent()">âœ… ç‰¹å…¸å†…å®¹ã‚’ä¿å­˜</button>
                        </div>
                    </div>
                    
                    <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
                    <div id="dashboard" class="tab-pane">
                        <h2>ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ <span style="font-size: 0.8em; color: #6c757d;">ğŸ”’ ç®¡ç†è€…å°‚ç”¨</span></h2>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalParticipants">0</div>
                                <div class="stat-label">ç·å‚åŠ è€…æ•°</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="todayParticipants">0</div>
                                <div class="stat-label">ä»Šæ—¥ã®å‚åŠ è€…</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="pendingProcess">0</div>
                                <div class="stat-label">å‡¦ç†å¾…ã¡</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalStamps">0</div>
                                <div class="stat-label">ä»˜ä¸ã‚¹ã‚¿ãƒ³ãƒ—æ•°</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 30px;">
                            <h3>ğŸ“ˆ å‚åŠ çŠ¶æ³ã‚°ãƒ©ãƒ•</h3>
                            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; min-height: 200px; display: flex; align-items: center; justify-content: center; color: #6c757d;">
                                ğŸ“Š ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚¨ãƒªã‚¢<br>
                                <small>ï¼ˆå®Ÿè£…æ™‚ã«Chart.jsãªã©ã‚’ä½¿ç”¨ï¼‰</small>
                            </div>
                        </div>
                        
                        <div>
                            <h3>ğŸ”„ ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ</h3>
                            <button class="btn btn-primary" onclick="refreshDashboard()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>
                            <button class="btn btn-warning" onclick="backupData()">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
                            <button class="btn btn-danger" onclick="clearTestData()">ğŸ—‘ï¸ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
                            <button class="btn" onclick="logout()" style="background: #e74c3c; color: white; margin-left: 20px;">ğŸšª ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3>ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</h3>
                            <div id="systemLog" style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                                <div>2025-07-23 10:00:00 - ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•</div>
                                <div>2025-07-23 10:01:00 - ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–å®Œäº†</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ï¼ˆå®Ÿéš›ã®é‹ç”¨ã§ã¯å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ï¼‰
        let participants = JSON.parse(localStorage.getItem('participants') || '[]');
        let rewardContent = localStorage.getItem('rewardContent') || 'é™å®šå£ç´™ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹•ç”»ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚ã”å‚åŠ ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼';
        
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
        const SYSTEM_PASSWORD = 'systemfam08';
        const DATA_VIEW_PASSWORD = 'scdfambam';
        const ADMIN_PASSWORD = 'fambam0819';
        
        // èªè¨¼çŠ¶æ…‹ç®¡ç†
        let isSystemAuthenticated = false;
        let isDataViewAuthenticated = false;
        let isAdminAuthenticated = false;
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            document.getElementById('systemLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const password = document.getElementById('systemPassword').value;
                
                if (password === SYSTEM_PASSWORD) {
                    isSystemAuthenticated = true;
                    document.getElementById('loginOverlay').classList.add('hidden');
                    document.getElementById('mainSystem').classList.remove('hidden');
                    initializeSystem();
                    addSystemLog('ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ');
                } else {
                    document.getElementById('loginError').textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚';
                    document.getElementById('loginError').style.display = 'block';
                    document.getElementById('systemPassword').value = '';
                }
            });
        });
        
        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        function initializeSystem() {
            document.getElementById('receivedDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('rewardContent').value = rewardContent;
            
            // å‚åŠ è€…ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            document.getElementById('participantForm').addEventListener('submit', handleParticipantSubmit);
            
            updateRecentData();
            updateParticipantsTable();
            updateDashboard();
            addSystemLog('ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
        }
        
        // å‚åŠ è€…ãƒ‡ãƒ¼ã‚¿ç™»éŒ²å‡¦ç†ã‚’é–¢æ•°ã¨ã—ã¦åˆ†é›¢
        function handleParticipantSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const participant = {
                id: Date.now(),
                memberId: formData.get('memberId'),
                memberName: formData.get('memberName'),
                receivedDate: formData.get('receivedDate'),
                notes: formData.get('notes'),
                status: 'pending',
                processedAt: null,
                stampCount: 0,
                createdAt: new Date().toISOString()
            };
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            const existing = participants.find(p => 
                p.memberId === participant.memberId && 
                p.receivedDate === participant.receivedDate
            );
            
            if (existing) {
                showAlert('harvestAlert', 'warning', 'âš ï¸ åŒã˜ä¼šå“¡ç•ªå·ãƒ»åŒã˜æ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚');
                return;
            }
            
            participants.push(participant);
            localStorage.setItem('participants', JSON.stringify(participants));
            
            showAlert('harvestAlert', 'success', 'âœ… ãƒ‡ãƒ¼ã‚¿ã‚’æ­£å¸¸ã«ç™»éŒ²ã—ã¾ã—ãŸã€‚');
            clearForm();
            updateRecentData();
            updateParticipantsTable();
            addSystemLog(`æ–°è¦å‚åŠ è€…ç™»éŒ²: ${participant.memberId} (${participant.memberName})`);
        }
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabName, tabButton) {
            // èªè¨¼ãƒã‚§ãƒƒã‚¯
            if (tabName === 'harvest' && !checkDataViewAuth()) {
                return;
            }
            if ((tabName === 'fanclub' || tabName === 'dashboard') && !checkAdminAuth()) {
                return;
            }
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã¨ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
            tabButton.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚ŒãŸæ™‚ã¯ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            if (tabName === 'dashboard') {
                updateDashboard();
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿é–²è¦§èªè¨¼ãƒã‚§ãƒƒã‚¯
        function checkDataViewAuth() {
            if (!isDataViewAuthenticated) {
                const password = prompt('ãƒ‡ãƒ¼ã‚¿é–²è¦§ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ï¼š');
                if (password === DATA_VIEW_PASSWORD) {
                    isDataViewAuthenticated = true;
                    updateRecentData();
                    return true;
                } else if (password !== null) {
                    alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚');
                }
                return false;
            }
            return true;
        }
        
        // ç®¡ç†è€…èªè¨¼ãƒã‚§ãƒƒã‚¯
        function checkAdminAuth() {
            if (!isAdminAuthenticated) {
                const password = prompt('ç®¡ç†è€…ã‚¨ãƒªã‚¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ï¼š');
                if (password === ADMIN_PASSWORD) {
                    isAdminAuthenticated = true;
                    return true;
                } else if (password !== null) {
                    alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚');
                }
                return false;
            }
            return true;
        }
        
        // å‚åŠ è€…ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ï¼ˆã“ã®éƒ¨åˆ†ã‚’å‰Šé™¤ï¼‰
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function clearForm() {
            document.getElementById('participantForm').reset();
            document.getElementById('receivedDate').value = new Date().toISOString().split('T')[0];
        }
        
        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
        function showAlert(elementId, type, message) {
            const alertElement = document.getElementById(elementId);
            alertElement.className = `alert alert-${type}`;
            alertElement.innerHTML = message;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }
        
        // æœ€è¿‘ã®ãƒ‡ãƒ¼ã‚¿æ›´æ–°
        function updateRecentData() {
            if (!isDataViewAuthenticated) {
                document.getElementById('recentDataBody').innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">ğŸ”’ ãƒ‡ãƒ¼ã‚¿é–²è¦§ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</td></tr>';
                return;
            }
            
            const tbody = document.getElementById('recentDataBody');
            const recentParticipants = participants.slice(-10).reverse();
            
            tbody.innerHTML = recentParticipants.map(p => `
                <tr>
                    <td>${p.memberId}</td>
                    <td>${p.memberName}</td>
                    <td>${p.receivedDate}</td>
                    <td><span class="status-badge status-${p.status}">${getStatusText(p.status)}</span></td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteParticipant(${p.id})" style="padding: 4px 8px; font-size: 12px;">å‰Šé™¤</button>
                    </td>
                </tr>
            `).join('');
        }
        
        // å‚åŠ è€…ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
        function updateParticipantsTable() {
            const tbody = document.getElementById('participantsTableBody');
            
            tbody.innerHTML = participants.map(p => `
                <tr>
                    <td><input type="checkbox" value="${p.id}" class="participant-checkbox"></td>
                    <td>${p.memberId}</td>
                    <td>${p.memberName}</td>
                    <td>${p.receivedDate}</td>
                    <td>${p.processedAt ? new Date(p.processedAt).toLocaleDateString() : '-'}</td>
                    <td><span class="status-badge status-${p.status}">${getStatusText(p.status)}</span></td>
                    <td>${p.stampCount || 0}</td>
                    <td>
                        <button class="btn btn-success" onclick="processIndividual(${p.id})" style="padding: 4px 8px; font-size: 12px;" ${p.status === 'processed' ? 'disabled' : ''}>
                            ${p.status === 'processed' ? 'å®Œäº†' : 'å‡¦ç†'}
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
        function getStatusText(status) {
            const statusMap = {
                'pending': 'å‡¦ç†å¾…ã¡',
                'processed': 'å®Œäº†',
                'error': 'ã‚¨ãƒ©ãƒ¼'
            };
            return statusMap[status] || status;
        }
        
        // å‚åŠ è€…å‰Šé™¤
        function deleteParticipant(id) {
            if (confirm('ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                participants = participants.filter(p => p.id !== id);
                localStorage.setItem('participants', JSON.stringify(participants));
                updateRecentData();
                updateParticipantsTable();
                updateDashboard();
                addSystemLog(`å‚åŠ è€…ãƒ‡ãƒ¼ã‚¿å‰Šé™¤: ID ${id}`);
            }
        }
        
        // å€‹åˆ¥å‡¦ç†
        function processIndividual(id) {
            const participant = participants.find(p => p.id === id);
            if (participant && participant.status === 'pending') {
                participant.status = 'processed';
                participant.processedAt = new Date().toISOString();
                participant.stampCount = (participant.stampCount || 0) + 1;
                
                localStorage.setItem('participants', JSON.stringify(participants));
                updateParticipantsTable();
                updateDashboard();
                addSystemLog(`ç‰¹å…¸é…å¸ƒå®Œäº†: ${participant.memberId}`);
                
                showAlert('fanclubAlert', 'success', `âœ… ${participant.memberName}ã•ã‚“ã®ç‰¹å…¸é…å¸ƒã‚’å®Œäº†ã—ã¾ã—ãŸã€‚`);
            }
        }
        
        // ç‰¹å…¸é…å¸ƒå®Ÿè¡Œ
        function processRewards() {
            const checkboxes = document.querySelectorAll('.participant-checkbox:checked');
            if (checkboxes.length === 0) {
                showAlert('fanclubAlert', 'warning', 'âš ï¸ å‡¦ç†ã™ã‚‹å‚åŠ è€…ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            let processedCount = 0;
            checkboxes.forEach(checkbox => {
                const id = parseInt(checkbox.value);
                const participant = participants.find(p => p.id === id);
                if (participant && participant.status === 'pending') {
                    participant.status = 'processed';
                    participant.processedAt = new Date().toISOString();
                    participant.stampCount = (participant.stampCount || 0) + 1;
                    processedCount++;
                }
            });
            
            if (processedCount > 0) {
                localStorage.setItem('participants', JSON.stringify(participants));
                updateParticipantsTable();
                updateDashboard();
                addSystemLog(`ä¸€æ‹¬ç‰¹å…¸é…å¸ƒ: ${processedCount}ä»¶`);
                showAlert('fanclubAlert', 'success', `âœ… ${processedCount}ä»¶ã®ç‰¹å…¸é…å¸ƒã‚’å®Œäº†ã—ã¾ã—ãŸã€‚`);
            }
        }
        
        // ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ä¸
        function sendStamps() {
            const checkboxes = document.querySelectorAll('.participant-checkbox:checked');
            if (checkboxes.length === 0) {
                showAlert('fanclubAlert', 'warning', 'âš ï¸ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ä¸ã™ã‚‹å‚åŠ è€…ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            checkboxes.forEach(checkbox => {
                const id = parseInt(checkbox.value);
                const participant = participants.find(p => p.id === id);
                if (participant) {
                    participant.stampCount = (participant.stampCount || 0) + 1;
                }
            });
            
            localStorage.setItem('participants', JSON.stringify(participants));
            updateParticipantsTable();
            updateDashboard();
            addSystemLog(`ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ä¸: ${checkboxes.length}ä»¶`);
            showAlert('fanclubAlert', 'success', `ğŸ† ${checkboxes.length}ä»¶ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ä¸ã—ã¾ã—ãŸã€‚`);
        }
        
        // å…¨é¸æŠåˆ‡ã‚Šæ›¿ãˆ
        function toggleAll(master) {
            const checkboxes = document.querySelectorAll('.participant-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = master.checked;
            });
        }
        
        // æ¤œç´¢
        function searchParticipants() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#participantsTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // ç‰¹å…¸å†…å®¹ä¿å­˜
        function setRewardContent() {
            const content = document.getElementById('rewardContent').value;
            localStorage.setItem('rewardContent', content);
            rewardContent = content;
            showAlert('fanclubAlert', 'success', 'âœ… ç‰¹å…¸å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "ä¼šå“¡ç•ªå·,ãŠåå‰,å—å–æ—¥,å‡¦ç†æ—¥,ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹,ã‚¹ã‚¿ãƒ³ãƒ—æ•°,å‚™è€ƒ\n"
                + participants.map(p => 
                    `${p.memberId},${p.memberName},${p.receivedDate},${p.processedAt || ''},${getStatusText(p.status)},${p.stampCount || 0},"${p.notes || ''}"`
                ).join('\n');
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `fooddrive_data_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addSystemLog('ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œ');
        }
        
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
        function updateDashboard() {
            const total = participants.length;
            const today = new Date().toISOString().split('T')[0];
            const todayCount = participants.filter(p => p.receivedDate === today).length;
            const pending = participants.filter(p => p.status === 'pending').length;
            const totalStamps = participants.reduce((sum, p) => sum + (p.stampCount || 0), 0);
            
            document.getElementById('totalParticipants').textContent = total;
            document.getElementById('todayParticipants').textContent = todayCount;
            document.getElementById('pendingProcess').textContent = pending;
            document.getElementById('totalStamps').textContent = totalStamps;
        }
        
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°ãƒœã‚¿ãƒ³
        function refreshDashboard() {
            updateDashboard();
            addSystemLog('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ‰‹å‹•æ›´æ–°');
            showAlert('fanclubAlert', 'success', 'âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚');
        }
        
        // ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
        function backupData() {
            const backupData = {
                participants: participants,
                rewardContent: rewardContent,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `fooddrive_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            addSystemLog('ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ');
        }
        
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearTestData() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                participants = [];
                localStorage.clear();
                updateRecentData();
                updateParticipantsTable();
                updateDashboard();
                addSystemLog('å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Ÿè¡Œ');
                alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
            }
        }
        
        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
        function logout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                isSystemAuthenticated = false;
                isDataViewAuthenticated = false;
                isAdminAuthenticated = false;
                
                // ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
                document.getElementById('mainSystem').classList.add('hidden');
                document.getElementById('loginOverlay').classList.remove('hidden');
                document.getElementById('systemPassword').value = '';
                document.getElementById('loginError').style.display = 'none';
                
                // æœ€åˆã®ã‚¿ãƒ–ã«æˆ»ã™
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                document.querySelector('.tab').classList.add('active');
                document.getElementById('harvest').classList.add('active');
                
                updateRecentData();
                addSystemLog('ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ');
            }
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°è¿½åŠ 
        function addSystemLog(message) {
            const timestamp = new Date().toLocaleString('ja-JP');
            const logElement = document.getElementById('systemLog');
            const logEntry = document.createElement('div');
            logEntry.textContent = `${timestamp} - ${message}`;
            logElement.appendChild(logEntry);
            
            // ãƒ­ã‚°ãŒå¤šããªã£ãŸã‚‰å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
            if (logElement.children.length > 50) {
                logElement.removeChild(logElement.firstChild);
            }
            
            // æœ€æ–°ãƒ­ã‚°ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // å®šæœŸçš„ãªãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°ï¼ˆ30ç§’é–“éš”ï¼‰
        setInterval(updateDashboard, 30000);
        
        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ç¢ºèª
        window.addEventListener('beforeunload', function(e) {
            const pendingCount = participants.filter(p => p.status === 'pending').length;
            if (pendingCount > 0) {
                e.preventDefault();
                e.returnValue = 'å‡¦ç†å¾…ã¡ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã¾ã™ã‹ï¼Ÿ';
            }
        });
    </script>
</body>
</html>